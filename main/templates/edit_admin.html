<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit People</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    {% load static %}
</head>
<style>
    body{
        margin: 0;
        background-color: #04070D;
    }
    .parent{
        display: flex;
        flex-direction: row;
    }
    ul{
        padding: 0;
        margin: 0;
        list-style: none;
    }
    li{
        margin-left: 13px;
        display: flex;
        align-items: center;
    }
    li img{
        margin-right: 10px;
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    li label{
        font-family: Inter;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
        color: white;
    }
    li:first-of-type{
        margin-bottom: 30px;
    }
    li{
        margin-bottom: 21px;
    }
    li:nth-of-type(6){
        margin-bottom: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        background: #CB102B;
        padding-left: 13px;
        border: 1px solid transparent;
        border-image-source: linear-gradient(90deg, #090F1A 0%, #A7AFBC 49.04%, #090F1A 100%);
        border-radius: 10px;
        width: 200px;
        margin-left: 0;
        border-image-slice: 1;
    }
    .nav_bar{
        width: 267px;
        background: #16181C;
        padding-left: 12px;
        overflow-y: scroll;
        scrollbar-width: none;
        height: 100dvh;
        z-index:1;
    }
    #creator_img{
        width: 138px;height: 60px;margin-top: 23px;margin-bottom: 68px;
    }
    .top_bar{
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
        font-family: 'Inter';
        height: 83px;
        padding-left: 30px;
        padding-right: 30px;
        border: 1px solid;
        border-image-source: linear-gradient(90deg, #090F1A 0%, #A7AFBC 49.04%, #090F1A 100%);
        border-image-slice: 1;

    }
    .top_bar label:first-of-type{
        font-weight: 600;
        font-size: 24px;
    }
    .top_bar img{
        width: 36px;
        height: 36px;
        margin-right: 7px;
    }
    .child{
        display: flex;
        flex: 1;
        flex-direction: column;
        width:100%;
    }
    .top_bar div label:first-of-type{
        color: #D5DBE6;
        font-family: Inter;
        font-weight: 500;
        font-size: 14px;
    }
    .top_bar div label:nth-of-type(2){
        color: #D5DBE6;
        font-family: Inter;
        font-weight: 400;
        font-size: 12px;
    }
    .add_msg{
        display: flex;
        margin:30px 0px 46px 30px;
    }
    .add_msg label{
        font-family: Inter;
        font-weight: 500;
        font-size: 20px;
        color: #D5DBE6;
        width: 265px;

    }
    .details div:first-of-type label:first-of-type{
        font-family: 'Inter';
        font-weight: 500;
        font-size: 16px;
        color: #D5DBE6;
    }
    .details div:first-of-type label:nth-of-type(2){
        font-family: 'Inter';
        font-weight: 400;
        font-size: 14px;
        color: #D5DBE6;
    }
    .details{
        margin: 0px 30px 0px 30px;
    }
    .details input,select{
        border-top: 1px solid;
        border-image-source: linear-gradient(108.87deg, rgba(255, 255, 255, 0.8) 0.66%, rgba(211, 211, 211, 0.1) 99.48%);
        border-image-slice: 1;
        backdrop-filter: blur(60px);
        background: linear-gradient(109.46deg, rgba(201, 201, 201, 0.4) 1.57%, rgba(196, 196, 196, 0.1) 100%);
        min-width: 240px;
        border-radius: 7px;
        padding:12px 16px 12px 16px;
        color: white;
        margin-bottom: 16px;
    }
    .details div label{
        font-family: 'Inter';
        font-weight: 400;
        font-size: 14px;
        color: white;
        margin-bottom: 8px;
    }
    .details input::placeholder{
        color: white;
    }
    .details div:nth-of-type(2),.details div:nth-of-type(3){
        width: 330px;
    }
    .buttons{
        margin-top: 28px;
        margin-right: 30px;
        gap: 16px;
    }
    .buttons button:nth-of-type(2){
        background: #CB102B;
        border-radius: 5px;
        padding: 12px;
        font-family: 'Inter';
        font-weight: 500;
        color: var(--Text-Brand-On-Brand, #F5F5F5);
        border: none;
    }
    .buttons button:nth-of-type(1){
        background: #23272A;
        border-radius: 5px;
        padding: 12px;
        font-family: 'Inter';
        font-weight: 500;
        color: var(--Text-Brand-On-Brand, #F5F5F5);
        border: none;
    }
    select,button{
        cursor: pointer;
    }
    #dialog{
        background: linear-gradient(109.46deg, rgba(201, 201, 201, 0.4) 1.57%, rgba(196, 196, 196, 0.1) 100%);
        backdrop-filter: blur(60px);
        border-radius: 7px;
        border: 1px solid white;
        font-size: 16px;
        color: white;
        font-family: 'Inter';
        font-weight: 400;
        align-items: center;
    }
    #bar_button{
        display:none;
        border:none;
        border-radius:5px;
        background-color:white;
        color:#CB102B;
        margin-right:5px;
        cursor:pointer;
    }
    select option{
        color:black;
    }
    @media(max-width:1700px)
    {
        .nav_bar{
            display:none;
        }
        #bar_button{
            display:block;
        }
        .top_bar{
            padding-left:10px;
            padding-right:10px;
        }
        .add_msg{
            margin: 30px 0px 46px 10px;
        }
        .details{
            margin:0px 10px;
        }
        .buttons{
            margin-right:10px;
        }
    }
</style>
<body>
    <dialog id="dialog"></dialog>
    <div class="parent">
        <div class="nav_bar">
            <nav>
                <img id="creator_img"  src="{% static 'creator_studio_pic.png' %}" alt="">
                <ul style="list-style: none;"> 
                    <li ><img src="{% static 'Home.png' %}" alt=""><label>Dashboard</label></li>
                    <li ><img src="{% static 'Image (7).png' %}" alt=""><label>AI Image Generation</label></li>
                    <li ><img src="{% static 'Users.png' %}" alt=""><label>My Models</label></li>
                    <li ><img src="{% static 'Zap.png' %}" alt=""><label>Model Store</label></li>
                    <li ><img src="{% static 'Trending up.png' %}" alt=""><label>Analytics</label></li>
                    <li ><img src="{% static 'User.png' %}"  alt=""><label>Users</label></li>
                    <li ><img src="{% static 'settings.png' %}"  alt=""><label>Settings</label></li>
                    <li ><img src="{% static 'alert-circle.png' %}"  alt=""><label>Help & Policies Center</label></li>
                    <li ><img src="{% static 'Disc.png' %}"  alt=""><label>Issues</label></li>
                </ul>
            </nav>
        </div>
        <div class="child">
            <div class="top_bar">
                <button id="bar_button"><i class="fas fa-bars"></i></button>
                <label>Edit User</label>
                <img onclick="localStorage.removeItem('email');window.location.href='/creator_studio_login'" style="cursor: pointer;margin-left: auto;cursor: pointer;" src="{% static 'Ellipse 8.png' %}" alt="">
                <div  style="display: flex;flex-direction: column;cursor: pointer;">
                    <label style="cursor: pointer;" onclick="localStorage.removeItem('email');window.location.href='/creator_studio_login'" id="name"></label>
                    <label style="cursor: pointer;" onclick="localStorage.removeItem('email');window.location.href='/creator_studio_login'">Log Out</label>
                </div>
            </div>
            <div class="add_msg">
                <label>Edit general user information</label>
            </div>
            <div class="details" style="display: flex;overflow:scroll;scrollbar-width:none;">
                <div style="display: flex;flex-direction: column;min-width:120px;margin-right:20px;">
                    <label>Basic Details</label>
                    <label>Add required details</label>
                </div>
                <div style="display: flex;flex-direction: column;margin-left: auto;margin-right: 20px;">
                    <label>Full Name <label>*</label></label>
                    <input disabled placeholder="Full Name" type="text" id="fullname">
                    <label>Country of residence</label>
                    <select id="residence">
                        <option value="Anonymous">Country of Residence</option>
                        <option value="Pakistan">Pakistan</option>
                        <option value="India">India</option>
                        <option value="Australia">Australia</option>
                        <option value="United Kingdom">United Kingdom</option>
                        <option value="Canada">Canada</option>
                    </select>
                    <label>Password <label>*</label></label>
                    <input placeholder="Enter password" type="password" id="password">
                    <label>Account Status</label>
                    <select id="account_status">
                        <option value="Inactive">Inactive</option>
                        <option value="Active">Active</option>
                    </select>
                </div>
                <div style="display: flex;flex-direction: column;">
                    <label>Email Address <label>*</label></label>
                    <input disabled placeholder="Email Address" type="email" id="email">
                    <label>Heard about us from?</label>
                    <select id="source">
                        <option value="Anonymous">Select from the list</option>
                        <option value="Twitter">Twitter</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="Friends">Friends</option>
                        <option value="Youtube">Youtube</option>
                    </select>
                    <label>Confirm Password <label>*</label></label>
                    <input placeholder="Enter password" type="password" id="confirmpassword">
                    <label>Subscription Status</label>
                    <select id="subscription_status">
                        <option value="Inactive">Inactive</option>
                        <option value="Active">Active</option>
                    </select>
                </div>
                
            </div>
            <div class="buttons" style="display: flex;margin-left: auto;">
                <button id="cancel">Cancel</button>
                <button id="submit">Save Changes</button>

            </div>
        </div>
    </div>
    <script>
        let bar_button=document.getElementById('bar_button')
        bar_button.addEventListener('click',()=>
        {
            document.getElementsByClassName('nav_bar')[0].style.display='flex'
            document.getElementsByClassName('nav_bar')[0].style.position='fixed'
        })
        window.addEventListener('resize',()=>
        {
            if(window.innerWidth>1700)
            {
                document.getElementsByClassName('nav_bar')[0].style.display='flex'
                document.getElementsByClassName('nav_bar')[0].style.position='static'
            }
            else{
                document.getElementsByClassName('nav_bar')[0].style.display='none'
            }
        })
        document.addEventListener('click',(e)=>
        {
            if(e.target!==bar_button && e.target!==document.querySelectorAll('.top_bar i')[0]  && window.innerWidth<1701 && getComputedStyle(document.getElementsByClassName('nav_bar')[0]).display==='flex')
            {
                document.getElementsByClassName('nav_bar')[0].style.display='none'
            }
        })
        let user_to_be_edited=location.search.substring(1)
        document.body.style.display='none'
        if(localStorage.getItem('email')===null){
            window.location.href='/creator_studio_login';
        }
        fetch('/view_admin/all_users',{
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify({
                email:localStorage.getItem('email'),
                edit:user_to_be_edited
            })
        })
        
        .then(responce=>responce.json())
        .then(data=>
        {
            console.log(data)
            if(data.status==='SubUser' || !data.success)
            {
                window.location.href='/view_admin'
            }
            else{
                document.getElementById('name').innerHTML=data.name
                document.body.style.display='block'
                email.value=data.edited[0].email
                password.value=data.edited[0].password
                confirmpassword.value=data.edited[0].password
                fullname.value=data.edited[0].fullname
                source.value=data.edited[0].source
                account_status.value=data.edited[0].account
                subscription_status.value=data.edited[0].subscription
                residence.value=data.edited[0].residence
            }
        })
        let dialog=document.getElementById('dialog')
        let email=document.getElementById('email')
        let password=document.getElementById('password')
        let confirmpassword=document.getElementById('confirmpassword')
        let fullname=document.getElementById('fullname')
        let source=document.getElementById('source')
        let account_status=document.getElementById('account_status')
        let subscription_status=document.getElementById('subscription_status')
        let residence=document.getElementById('residence')
        let cancel=document.getElementById('cancel')
        let submit=document.getElementById('submit')
        cancel.addEventListener('click',()=>
        {
            window.location.href='/view_admin'
        })
        submit.addEventListener('click',()=>
        {
            if(email.value.length>0 && password.value.length>0 && confirmpassword.value.length>0 && fullname.value.length>0 )
            {
                fetch('/add_admin/add_user',{
                    method:'POST',
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({
                        email:email.value,
                        password:password.value,
                        confirmpassword:confirmpassword.value,
                        fullname:fullname.value,
                        source:source.value,
                        account:account_status.value,
                        subscription:subscription_status.value,
                        residence:residence.value,
                        parent:localStorage.getItem('email'),
                        edit:true
                    })
                })
                .then(responce=>responce.json())
                .then(data=>
                {
                    if(data.success)
                    {
                        window.location.href='/view_admin'
                    }
                    else{
                        dialog.showModal()
                        dialog.innerHTML=`${data.message} <p></p><button style="cursor: pointer;border:none;border-radius: 5px;background-color: #CB102B;color: white;padding: 5px;font-size: 16px;font-family: Inter;" onclick="dialog.close()">OK</button>`
                    }
                }
                )
            }
        })
    </script>
</body>
</html>
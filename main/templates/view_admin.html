<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View People</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    {% load static %}
</head>
<style>
    body{
        margin: 0;
        background-color: #04070D;
    }
    .parent{
        display: flex;
        flex-direction: row;
    }
    ul{
        padding: 0;
        margin: 0;
        list-style: none;
    }
    li{
        margin-left: 13px;
        display: flex;
        align-items: center;
    }
    li img{
        margin-right: 10px;
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    li label{
        font-family: Inter;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
        color: white;
    }
    li:first-of-type{
        margin-bottom: 30px;
    }
    li{
        margin-bottom: 21px;
    }
    li:nth-of-type(6){
        margin-bottom: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        background: #CB102B;
        padding-left: 13px;
        border: 1px solid transparent;
        border-image-source: linear-gradient(90deg, #090F1A 0%, #A7AFBC 49.04%, #090F1A 100%);
        border-radius: 10px;
        width: 200px;
        margin-left: 0;
        border-image-slice: 1;
    }
    .nav_bar{
        width: 267px;
        background: #16181C;
        padding-left: 12px;
        overflow-y: scroll;
        scrollbar-width: none;
        height: 100dvh;
    }
    #creator_img{
        width: 138px;height: 60px;margin-top: 23px;margin-bottom: 68px;
    }
    .top_bar{
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
        font-family: 'Inter';
        height: 83px;
        padding-left: 30px;
        padding-right: 30px;
        border: 1px solid;
        border-image-source: linear-gradient(90deg, #090F1A 0%, #A7AFBC 49.04%, #090F1A 100%);
        border-image-slice: 1;
        border:none;
    }
    .top_bar label:first-of-type{
        font-weight: 600;
        font-size: 24px;
    }
    .top_bar img{
        width: 36px;
        height: 36px;
        margin-right: 7px;
    }
    .child{
        display: flex;
        flex: 1;
        flex-direction: column;
        width:100%;
    }
    .top_bar div label:first-of-type{
        color: #D5DBE6;
        font-family: Inter;
        font-weight: 500;
        font-size: 14px;
    }
    .top_bar div label:nth-of-type(2){
        color: #D5DBE6;
        font-family: Inter;
        font-weight: 400;
        font-size: 12px;
    }
    .second_bar{
        display: flex;
        padding: 24px 30px 28px 0px;
        justify-content: flex-end;
    }
    .second_bar button{
        color: white;
        cursor: pointer;
        font-family: 'Inter';
        background: #CB102B;
        border-radius: 5px;
        border: none;
        font-size: 12px;
        font-weight: 500;
        width: 112px;
        height: 32px;
        padding:  0px 6px 0px 9px;
    }
    .second_bar img{
        cursor: pointer;
        width: 14px;
        height: 14px;
    }
    .user_records{
        border-radius: 15px;
        border: 1px solid #D5DBE6;
        box-shadow: 0px 1px 2px 0px var(--ColorsEffectsShadowsshadow-xs);
        margin-left: 30px;
        margin-right: 30px;
        overflow:scroll;
        scrollbar-width:none;
    }
    .user_records div{
        border-width: 0px 1px 1px 0px;
        border-style: solid;
        border-color: #D5DBE6;
        box-shadow: 0px 0px 2px 0px var(--ColorsEffectsShadowsshadow-xs);
        
    }
    .title{
        display:flex;
        height: 85px;
        align-items: center;
        padding: 0px 24px 0px 24px;
    }
    .title label:first-of-type{
        color: #D5DBE6;
        font-family: 'Inter';
        font-weight: 500;
        font-size: 16px;

    }
    .actual_records label{
        font-family: 'Inter';
        font-weight: 500;
        font-size: 14px;
        color: #D5DBE6;
        padding: 12px 0px 12px 0px;
        margin-left: 24px;
    }
    .actual_records div{
        display: flex;
        align-items: center;
        justify-content: space-between;
        width:fit-content;
    }
    .actual_records input{
        width: 20px;
        height: 20px;
        border: 1px solid var(--colors-foreground-fg-quaternary-400, #A4A7AE);
        border-width: 1px;
        border-radius: 6px;
        margin: 12px 12px 12px 24px;
    }
    .actual_records{
        border:none !important;
    }
    .actual_records label{
        overflow:scroll;
        scrollbar-width:none;
    }
    .actual_records label:first-of-type{
        width: 124px;
    }
    .actual_records label:nth-of-type(2){
        width: 182px;
    }
    .actual_records label:nth-of-type(3){
        width: 101px;
    }
    .actual_records label:nth-of-type(4){
        width: 130px;
    }
    .actual_records label:nth-of-type(5){
        width: 102px;
    }
    .actual_records label:nth-of-type(6){
        width: 116px;
    }
    .actual_records label:nth-of-type(7){
        width: 111px;
    }
    .actual_records label:nth-of-type(8){
        width: 193px;
    }
    .scroll_data{
        height: 68px;
        border: none !important;
    }
    #dialog{
        backdrop-filter: blur(60px);
        border-top: 1px solid transparent;
        border-image-source: linear-gradient(108.87deg, rgba(255, 255, 255, 0.8) 0.66%, rgba(211, 211, 211, 0.1) 99.48%);
        border-image-slice: 1;
        background: linear-gradient(109.46deg, rgba(201, 201, 201, 0.4) 1.57%, rgba(196, 196, 196, 0.1) 100%);
        border-radius: 7px;
    }
    #del1{
        font-family: Inter;
        font-weight: 500;
        font-size: 28px;
        color: #D5DBE6;
        margin-top: 65px;
    }
    #del2{
        font-family: Inter;
        font-weight: 400;
        font-size: 16px;
        color: #D5DBE6;
        margin-top: 30px;
        margin-bottom: 45px;
    }
    #del_div button{
        border: none;
        padding: 12px;
        border-radius: 5px;
        backdrop-filter: blur(60px);
        color: var(--Text-Brand-On-Brand, #F5F5F5);
        font-family: 'Inter';
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
    }
    #cancel2{
        background: var(--Background-Danger-Default, #EC221F);
    }
    #cancel1{
        background: linear-gradient(109.46deg, rgba(201, 201, 201, 0.4) 1.57%, rgba(196, 196, 196, 0.1) 100%);
    }
    #del_div{
        display: flex;
        flex-direction: row;
        gap:20px;
        margin-bottom: 45px;
    }
    #bar_button{
        display:none;
        border:none;
        border-radius:5px;
        background-color:white;
        color:#CB102B;
        margin-right:5px;
        cursor:pointer;
    }
    @media(max-width:1700px)
    {
        .nav_bar{
            display:none;
        }
        #bar_button{
            display:block;
        }
        .user_records{
            margin-left:10px;
            margin-right:10px;
        }
        .top_bar{
            padding-left:10px;
            padding-right:10px;
        }
        .second_bar{
            padding:24px 10px 28px 0px;
        }
    }
    
</style>
<body>
    <dialog id="dialog"></dialog>
    <div class="parent">
        <div class="nav_bar">
            <nav>
                <img id="creator_img"  src="{% static 'creator_studio_pic.png' %}" alt="">
                <ul style="list-style: none;"> 
                    <li ><img src="{% static 'Home.png' %}" alt=""><label>Dashboard</label></li>
                    <li ><img src="{% static 'Image (7).png' %}" alt=""><label>AI Image Generation</label></li>
                    <li ><img src="{% static 'Users.png' %}" alt=""><label>My Models</label></li>
                    <li ><img src="{% static 'Zap.png' %}" alt=""><label>Model Store</label></li>
                    <li ><img src="{% static 'Trending up.png' %}" alt=""><label>Analytics</label></li>
                    <li ><img src="{% static 'User.png' %}"  alt=""><label>Users</label></li>
                    <li ><img src="{% static 'settings.png' %}"  alt=""><label>Settings</label></li>
                    <li ><img src="{% static 'alert-circle.png' %}"  alt=""><label>Help & Policies Center</label></li>
                    <li ><img src="{% static 'Disc.png' %}"  alt=""><label>Issues</label></li>
                </ul>
            </nav>
        </div>
        <div class="child">
            <div class="top_bar">
                <button id="bar_button"><i class="fas fa-bars"></i></button>
                <label>All Users</label>
                <img onclick="localStorage.removeItem('email');window.location.href='/creator_studio_login'" style="cursor: pointer;margin-left: auto;cursor: pointer;" src="{% static 'Ellipse 8.png' %}" alt="">
                <div  style="display: flex;flex-direction: column;cursor: pointer;">
                    <label style="cursor: pointer;" onclick="localStorage.removeItem('email');window.location.href='/creator_studio_login'" id="name"></label>
                    <label style="cursor: pointer;" onclick="localStorage.removeItem('email');window.location.href='/creator_studio_login'">Log Out</label>
                </div>
            </div>
            <div class="second_bar">
                <button id="add_user" style="display: flex;align-items: center;">
                    <label style="margin-right: 5px;width: 78px;text-align: start;cursor: pointer;">Add User</label>
                    <img  src="{% static 'Plus.png' %}" alt="">
                </button>
            </div>
            <div class="user_records">
                <div class="title" style="border:none">
                    <label>Users List</label>
                </div>
                <div class="actual_records">
                    <div style="border-width:1px 1px 1px 0px;" >
                        <input type="checkbox" >
                        <label>Name</label>
                        <label>Email Address</label>
                        <label>Source</label>
                        <label>Country</label>
                        <label>Account</label>
                        <label>Subscription</label>
                        <label>Last Login</label>
                        <label>Actions</label>

                    </div>
                </div>
                <div class="scroll_data">.</div>
            </div>
        </div>
    </div>
    <script>
        let bar_button=document.getElementById('bar_button')
        bar_button.addEventListener('click',()=>
        {
            document.getElementsByClassName('nav_bar')[0].style.display='flex'
            document.getElementsByClassName('nav_bar')[0].style.position='fixed'
        })
        window.addEventListener('resize',()=>
        {
            if(window.innerWidth>1700)
            {
                document.getElementsByClassName('nav_bar')[0].style.display='flex'
                document.getElementsByClassName('nav_bar')[0].style.position='static'
            }
            else{
                document.getElementsByClassName('nav_bar')[0].style.display='none'
            }
        })
        document.addEventListener('click',(e)=>
        {
            if(e.target!==bar_button && e.target!==document.querySelectorAll('.top_bar i')[0]  && window.innerWidth<1701 && getComputedStyle(document.getElementsByClassName('nav_bar')[0]).display==='flex')
            {
                document.getElementsByClassName('nav_bar')[0].style.display='none'
            }
        })
        document.body.style.display='none'
        function navigate()
        {
            window.location.href = "/add_admin"
        }
        if(localStorage.getItem('email')===null){

            window.location.href='/creator_studio_login';
        }
        let name=document.getElementById('name')
        let add_user = document.getElementById("add_user")
        add_user.addEventListener("click",navigate)
        fetch('/view_admin/all_users',{
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify({
                email:localStorage.getItem('email'),
                edit:false
            })
        })
        
        .then(responce=>responce.json())
        .then(data=>
        {
            console.log(data)
            if(data.status==='SubUser')
            {
                add_user.removeEventListener('click',navigate)
                add_user.addEventListener('click',function(){
                    dialog.showModal()
                    dialog.innerHTML=`<label style="font-size: 16px;font-family: Inter;color: white;">You don't have permission to add users being a Tier-3 user!</label> <p></p><button style="cursor: pointer;border:none;border-radius: 5px;background-color: #CB102B;color: white;padding: 5px;font-size: 16px;font-family: Inter;" onclick="dialog.close()">OK</button>`
                })
            }
            name.innerHTML=data.name
            for(let i=0;i<data.people.length;i++)
            {
                let user_div=document.createElement('div')
                if(i===data.people.length-1)
                {
                }
                let input=document.createElement('input')
                input.setAttribute('type','checkbox')
                let name=document.createElement('label')
                name.innerHTML=data.people[i].fullname
                let email=document.createElement('label')
                email.innerHTML=data.people[i].email
                let source=document.createElement('label')
                source.innerHTML=data.people[i].source
                let country=document.createElement('label')
                country.innerHTML=data.people[i].residence
                let account=document.createElement('label')
                account.innerHTML=data.people[i].account
                if(data.people[i].account=='Inactive') 
                {
                    account.style.color='var(--Component-colors-Utility-Warning-utility-warning-500, #F79009)'
                }
                else
                {
                    account.style.color='var(--Component-colors-Utility-Success-utility-success-600, #079455)';
                }
                let subscription=document.createElement('label')
                subscription.innerHTML=data.people[i].subscription
                if(data.people[i].subscription=='Inactive') 
                {
                    subscription.style.color='var(--Component-colors-Utility-Warning-utility-warning-500, #F79009)'
                }
                else
                {
                    subscription.style.color='var(--Component-colors-Utility-Success-utility-success-600, #079455)';
                }
                let last_login=document.createElement('label')
                if(data.people[i].last_login!==null)
                {
                    last_login.innerHTML=new Date( data.people[i].last_login).getDate()===new Date().getDate()?new Date( data.people[i].last_login).toLocaleTimeString():new Date( data.people[i].last_login).toLocaleDateString()
                }
                else{
                    last_login.innerHTML='Not Yet'
                }
                let actions=document.createElement('label')
                let view=document.createElement('label')
                view.innerHTML='View'
                let edit=document.createElement('label')
                edit.innerHTML='Edit'
                let del=document.createElement('label')
                del.innerHTML='Delete'
                view.style.marginLeft='0px'
                view.style.marginRight='12px'
                view.style.cursor='pointer'
                edit.style.cursor='pointer'
                edit.style.marginLeft='0px'
                edit.style.marginRight='12px'
                edit.addEventListener('click',()=>
                {
                    if(data.status==='SubUser'){
                        dialog.showModal()
                        dialog.innerHTML=`<label style="font-size: 16px;font-family: Inter;color: white;">You don't have permission to edit users being a Tier-3 user!</label> <p></p><button style="cursor: pointer;border:none;border-radius: 5px;background-color: #CB102B;color: white;padding: 5px;font-size: 16px;font-family: Inter;" onclick="dialog.close()">OK</button>`
                    }
                    else{window.location.href=`/edit_admin?${data.people[i].email}`}
                })
                del.style.cursor='pointer';
                del.addEventListener('click',function(){
                    dialog.showModal()
                    let div_pro=document.createElement('div')
                    div_pro.style.display='flex'
                    div_pro.style.flexDirection='column'
                    div_pro.style.alignItems='center'
                    let label1=document.createElement('label')
                    label1.innerHTML=data.status!=='SubUser'?'Permanently Delete':'Feature Disabled'
                    label1.id='del1'
                    let label2=document.createElement('label')
                    label2.id='del2'
                    label2.innerHTML=data.status!=='SubUser'?'Are you sure you wish to permanently delete this content? This cannot be undone.':'This operation is only possible if you are the parent admin of this user.'
                    
                    let div=document.createElement('div')
                    div.id='del_div'
                    let cancel1=document.createElement('button')
                    cancel1.innerHTML='Cancel'
                    cancel1.id='cancel1'
                    cancel1.addEventListener('click',function(){
                        dialog.close()
                    })
                    
                    let cancel2=document.createElement('button')
                    cancel2.innerHTML='Delete Content'
                    cancel2.id='cancel2'
                    cancel2.style.display=data.status!=='SubUser'?'block':'none'
                    cancel2.addEventListener('click',function(){
                        dialog.close()
                        fetch('/view_admin/delete_user',{
                            method:'POST',
                            headers:{
                                'Content-Type':'application/json'
                            },
                            body:JSON.stringify({
                                email:data.people[i].email
                            })
                        })
                        .then(responce=>responce.json())
                        .then(data=>
                        {
                            console.log(data)
                            if(data.success)
                            {
                                document.getElementsByClassName('actual_records')[0].removeChild(user_div)
                            }
                        })
                    })
                    div.appendChild(cancel1)
                    div.appendChild(cancel2)
                    div_pro.appendChild(label1)
                    div_pro.appendChild(label2)
                    div_pro.appendChild(div)
                    dialog.innerHTML=''
                    dialog.appendChild(div_pro)
                })
                del.style.color= '#CB102B';
                del.style.marginLeft='0px'
                actions.appendChild(view)
                actions.appendChild(edit)
                actions.appendChild(del)
                user_div.appendChild(input)
                user_div.appendChild(name)
                user_div.appendChild(email)
                user_div.appendChild(source)
                user_div.appendChild(country)
                user_div.appendChild(account)
                user_div.appendChild(subscription)
                user_div.appendChild(last_login)
                user_div.appendChild(actions)
                document.getElementsByClassName('actual_records')[0].appendChild(user_div)
            }
        
            document.body.style.display='block'
        })
    </script>
</body>
</html>